{% extends "base.html" %}
{% load humanize %}

{% block title %}Apertura de Caja{% endblock %}

{% block content %}
<div class="min-h-screen w-full pb-16">
    <div class="mx-auto max-w-4xl px-6 py-12 space-y-8">
        <header class="glass-card rounded-3xl px-6 py-8">
            <p class="text-xs font-semibold uppercase tracking-[0.35em] text-muted">Gestión de caja</p>
            <h1 class="mt-2 text-3xl font-semibold text-slate-100 sm:text-4xl">Apertura de Caja</h1>
            <p class="mt-3 max-w-2xl text-sm text-muted">
                Seleccioná el local y el monto inicial en efectivo para abrir la caja del día.
            </p>
        </header>

        <form method="POST" class="glass-card rounded-3xl p-8 space-y-6" id="apertura-form">
            {% csrf_token %}
            
            <div>
                <label for="local_id" class="block text-sm font-semibold text-slate-100 mb-2">
                    Local <span class="text-red-400">*</span>
                </label>
                <select 
                    name="local_id" 
                    id="local_id" 
                    required
                    class="w-full rounded-2xl border border-slate-700 bg-slate-900/50 px-4 py-3 text-sm text-slate-100 focus:border-slate-500 focus:outline-none focus:ring-2 focus:ring-slate-500/50"
                >
                    <option value="">Seleccionar local...</option>
                    {% for local in locales %}
                        <option value="{{ local.id }}">{{ local.nombre }}</option>
                    {% endfor %}
                </select>
                {% if not locales %}
                    <p class="mt-2 text-xs text-amber-400">
                        No hay locales configurados. <a href="{% url 'configuracion:panel' %}" class="underline">Agregar local</a>
                    </p>
                {% endif %}
            </div>

            <div>
                <label for="monto_inicial_ars" class="block text-sm font-semibold text-slate-100 mb-2">
                    Monto Inicial (ARS) <span class="text-red-400">*</span>
                </label>
                <div class="relative">
                    <span class="absolute left-4 top-1/2 -translate-y-1/2 text-slate-400">$</span>
                    <input 
                        type="number" 
                        name="monto_inicial_ars" 
                        id="monto_inicial_ars" 
                        step="0.01" 
                        min="0" 
                        value="0.00"
                        required
                        class="w-full rounded-2xl border border-slate-700 bg-slate-900/50 pl-8 pr-4 py-3 text-sm text-slate-100 focus:border-slate-500 focus:outline-none focus:ring-2 focus:ring-slate-500/50"
                        placeholder="0.00"
                    />
                </div>
                <p class="mt-2 text-xs text-muted">Ingresá el monto en efectivo con el que se abre la caja.</p>
            </div>

            <div class="flex flex-col sm:flex-row gap-4 pt-4">
                <button 
                    type="submit" 
                    class="flex-1 rounded-2xl bg-gradient-to-r from-blue-600 to-indigo-600 px-6 py-3 text-sm font-semibold text-white shadow-lg shadow-blue-600/30 hover:from-blue-500 hover:to-indigo-500 transition-all"
                >
                    Abrir Caja
                </button>
                <a 
                    href="{% url 'dashboard:dashboard' %}" 
                    class="flex-1 rounded-2xl border border-slate-700 bg-slate-900/50 px-6 py-3 text-center text-sm font-semibold text-slate-100 hover:bg-slate-800/50 transition-all"
                >
                    Cancelar
                </a>
            </div>
        </form>

        {% if error %}
            <div class="glass-card rounded-3xl border border-red-500/40 px-6 py-5 text-sm text-red-200">
                <p class="font-semibold">Error</p>
                <p class="mt-1">{{ error }}</p>
            </div>
        {% endif %}
    </div>
</div>

<script>
document.getElementById('apertura-form').addEventListener('submit', function(e) {
    const localId = document.getElementById('local_id').value;
    const monto = document.getElementById('monto_inicial_ars').value;
    
    if (!localId) {
        e.preventDefault();
        alert('Debés seleccionar un local');
        return false;
    }
    
    if (!monto || parseFloat(monto) < 0) {
        e.preventDefault();
        alert('El monto inicial debe ser mayor o igual a 0');
        return false;
    }
});
</script>
{% endblock %}

